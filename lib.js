function doAlert(){DLEalert("Регистрируйтесь, и вы сможете добавлять в закладки, оценивать и многое другое!",'Необходима регистрация');};$(document).ready(function(){$("body").addClass("js");$('.t-rate').wRatePercent();$('.show-login').wModal({width:'320px'});$('.show-menu').wModal({width:'1200px'});$('.tabs-box').wTabs();$('.player-desc').wTextSlicer({height:'520',text:'Развернуть'});$('#rels').wCarouVertical({rows:'2',text:'Показать еще'});});$(document).ready(function(){$('body').on('click','.ps-link',function(){window.location.href=$(this).attr("data-href");});$('body').on('click','.ps-link2',function(){window.location.href=$(this).next().attr("href");});$('.nav-line').prepend('<div class="show-mob grady2"><span class="fa fa-bars"></span></div>');$(".show-mob").click(function(){$("nav").fadeToggle(200);$(this).find('.fa').toggleClass('fa-bars fa-times');});$('.sorter').each(function(){var a=$(this),b=a.find('li[class] a').html();a.append('<span>'+b+'<span class="fa fa-angle-down"></span></span>');a.click(function(){$(this).find('form').fadeToggle(100);});});$('body').on('click','#pagi-load a',function(){var $urlNext=$(this).attr('href');var $scrollNext=$(this).offset().top-200;if($urlNext!==undefined){$.ajax({url:$urlNext,beforeSend:function(){ShowLoading('');},success:function(data){$('#pagi-nav').remove();$('#dle-content').append($('#dle-content',data).html());$('#dle-content').after($('#pagi-nav'));$('.t-rate:not(.wp)').wRatePercent();window.history.pushState("","",$urlNext);$('html, body').animate({scrollTop:$scrollNext},800);HideLoading('');},error:function(){HideLoading('');alert('что-то пошло не так');}});};return false;});$('.rate3').each(function(){var ratebox=$(this);var ratevotes=ratebox.find('.rate-votes');var raterate=parseInt(ratebox.find('.ratingtypeplusminus').text(),10);var ratecount=parseInt(ratevotes.find('span[id]').text(),10);if(ratecount>=raterate){ratevotes.prepend('<span class="rateperc"></span>').after('<div class="ratebar"><div class="ratefill"></div></div>');var minusik=(ratecount-raterate)/2;var plusik=ratecount-minusik;if(ratecount>0){var fill=Math.round(plusik/ratecount*100);ratebox.find('.ratefill').css({'width':''+fill+'%'});ratevotes.children('.rateperc').text(fill+'%');}else{ratevotes.children('.rateperc').text('0%');};};});$('.login-social a').on('click',function(){var href=$(this).attr('href');var width=820;var height=420;var left=(screen.width-width)/2;var top=(screen.height-height)/2-100;auth_window=window.open(href,'auth_window',"width="+width+",height="+height+",top="+top+",left="+left+"menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no");return false;});$("#add-commbtn").click(function(){$("#add-comm-form").fadeToggle(200);});$(".comm-q").click(function(){$("#add-comm-form").fadeIn(200);});$('#dle-content > #dle-ajax-comments').appendTo($('#full-comms'));if($(window).width()>960){$('body').append('<div id="gotop"><span class="fa fa-chevron-up"></span></div>');var $gotop=$('#gotop');$(window).scroll(function(){if($(this).scrollTop()>300){$gotop.fadeIn(200);}else{$gotop.fadeOut(200);}});$gotop.click(function(){$('html, body').animate({scrollTop:0},'slow');});};});function doRateLD(rate,id){ShowLoading('');$.get(dle_root+"engine/ajax/rating.php",{go_rate:rate,news_id:id,skin:dle_skin,user_hash:dle_login_hash},function(data){HideLoading('');if(data.success){var rating=data.rating;rating=rating.replace(/&lt;/g,"<");rating=rating.replace(/&gt;/g,">");rating=rating.replace(/&amp;/g,"&");$("#ratig-layer-"+id).html(rating);$("#vote-num-id-"+id).html(data.votenum);var rt=parseInt($(rating).text()),m=(data.votenum-rt)/2,p=data.votenum-m,fill=Math.round(p/data.votenum*100);fRate=$("#f-rate-"+id);fRate.find('.rate-fill').css({'width':''+fill+'%'});fRate.find('.rate-likes').html('('+p+'/'+m+')');fRate.find('.rate-perc').html(fill+'%');}else if(data.error){DLEalert(data.errorinfo,dle_info);}},"json");};jQuery.fn.wRatePercent=function(){return this.each(function(){var a=$(this);var b=parseInt(a.find('.ratingtypeplusminus').text(),10);var c=parseInt(a.find('span[id*=vote]').text(),10);if(c>=b&&c>0){var t=Math.round((c-(c-b)/2)/c*100);a.text(t+'%');}else{a.text('0%');};a.addClass('wp');});};jQuery.fn.wTabs=function(){return this.each(function(){var tabsbox=$(this);tabsbox.find('.tabs-sel span:first').addClass('current');tabsbox.find('.tabs-b:first').addClass('visible');tabsbox.find('.tabs-sel').on('click','span:not(.current)',function(){$(this).addClass('current').siblings().removeClass('current');tabsbox.find('.tabs-b').hide().eq($(this).index()).fadeIn(400);});});};jQuery.fn.wTextSlicer=function(options){var options=jQuery.extend({height:'200',text:'show more'},options);return this.each(function(){var a=$(this),h=a.height();if(h>options.height){a.addClass('slice slice-masked').height(options.height).after('<div class="slice-btn"><span>'+options.text+'</span></div>');};$('.slice-btn span').click(function(){var bt=$(this),a=$(this).parent().prev('.slice');ah=parseInt(a.css("height"),10);ah==h?a.css({'height':options.height}):a.css({'height':h});bt.text(bt.text()==options.text?"Свернуть":options.text);a.toggleClass('slice-masked');});});};jQuery.fn.wRatePercent=function(){return this.each(function(){var a=$(this);var b=parseInt(a.find('.ratingtypeplusminus').text(),10);var c=parseInt(a.find('span[id]:last').text(),10);if(c>=b&&c>0){var t=Math.round((c-(c-b)/2)/c*100);a.text(t+'%');}else{a.text('0%');};a.addClass('wp');});};jQuery.fn.wCarouVertical=function(options){var options=jQuery.extend({item:'.thumb',rows:'2',text:'show more'},options);return this.each(function(){var a=$(this),h=a.height(),s=(a.find(options.item).outerHeight())*options.rows,m=s;a.wrap('<div style="overflow:hidden;height:'+s+'px;"></div>');var b=$('<div class="show-more button"><span>'+options.text+'</span></div>').insertAfter(a.parent());b.click(function(){if(m<h){a.animate({'margin-top':-m},600);m+=s;}
else{a.animate({'margin-top':'0'},600);m=s;};});});};jQuery.fn.wModal=function(options){var options=jQuery.extend({widthModal:'320px'},options);return this.each(function(){$(this).click(function(){var a=$(this),m=a.attr('data-modal'),mt=a.attr('data-title'),ms=$(m);wShowModal(ms,mt);return false;});$('body').on('click','.modal-content',function(e){e.stopPropagation();});$('body').on('click','.modal-mask, .modal-title .fa',function(){$('#modal-mask').fadeOut(200);setTimeout(function(){$('body').removeAttr('style');$('#modal-mask').remove();},200);});function wShowModal(a,b){$('body').css({'overflow':'hidden','padding-right':(window.innerWidth-document.body.clientWidth)+'px'});var modalMask=$('<div class="modal-mask" id="modal-mask"></div>').appendTo('body');modalMask.append('<div class="modal-content" style="width:'+options.width+';"><div class="modal-title">'+b+'<span class="fa fa-times"></span></div></div></div>');a.clone().appendTo(modalMask.find('.modal-content'));modalMask.add(modalMask.find('.modal')).fadeIn(200);var msh=(window.innerHeight-$(modalMask.find('.modal-content')).outerHeight())/2;if(msh>0){modalMask.css({'padding-top':msh+'px'})};};});};
